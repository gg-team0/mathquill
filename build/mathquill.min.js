/**
 * MathQuill v0.10.1, by Han, Jeanine, and Mary
 * http://mathquill.com | maintainers@mathquill.com
 *
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL
 * was not distributed with this file, You can obtain
 * one at http://mozilla.org/MPL/2.0/.
 */
function noop(){}function variadic(t){var e=t.length-1;return function(){var n=__slice.call(arguments,0,e),i=__slice.call(arguments,e);return t.apply(this,n.concat([i]))}}function iterator(t){return variadic(function(e,n){"function"!=typeof e&&(e=send(e));var i=function(t){return e.apply(t,[t].concat(n))};return t.call(this,i)})}function bind(t){var e=__slice.call(arguments,1);return function(){return t.apply(this,e)}}function pray(t,e){if(!e)throw new Error("prayer failed: "+t)}function prayDirection(t){pray("a direction was passed",t===L||t===R)}function prayWellFormed(t,e,n){pray("a parent is always present",t),pray("leftward is properly set up",function(){return e?e[R]===n&&e.parent===t:t.ends[L]===n}()),pray("rightward is properly set up",function(){return n?n[L]===e&&n.parent===t:t.ends[R]===e}())}function insistOnInterVer(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function MathQuill(t){return insistOnInterVer(),MQ1(t)}function getInterface(t){function e(t){var e,n;return t&&t.nodeType?(e=$(t).children(".mq-root-block").attr(mqBlockId),n=e&&Node.byId[e].controller,n?i[n.KIND_OF_MQ](n):null):null}function n(t,e){var n,s,a;e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:i});for(n in e)e.hasOwnProperty(n)&&(s=e[n],a=optionProcessors[n],t[n]=a?a(s):s)}var i,s,a;if(!(MIN<=t&&t<=MAX))throw"Only interface versions between "+MIN+" and "+MAX+" supported. You specified: "+t;i={},e.L=L,e.R=R,e.saneKeyboardEvents=saneKeyboardEvents,e.config=function(t){return n(Options.p,t),this},e.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";EMBEDS[t]=e},s=i.AbstractMathQuill=P(Progenote,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e,n=this.__controller,i=n.root,s=n.container;n.createTextarea(),e=s.addClass(t).contents().detach(),i.jQ=$('<span class="mq-root-block"/>').attr(mqBlockId,i.id).appendTo(s),this.latex(e.text()),this.revert=function(){return s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},t.config=function(t){return n(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),e.prototype=s.prototype,i.EditableField=P(s,function(t,e){t.__mathquillify=function(){return e.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},t.focus=function(){return this.__controller.textarea.focus(),this},t.blur=function(){return this.__controller.textarea.blur(),this},t.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},t.empty=function(){var t=this.__controller.root,e=this.__controller.cursor;return t.eachChild("postOrder","dispose"),t.ends[L]=t.ends[R]=0,t.jQ.empty(),delete e.selection,e.insAtRightEnd(t),this},t.cmd=function(t){var e,n=this.__controller.notify(),i=n.cursor;return/^\\[a-z]+$/i.test(t)&&!i.isTooDeep()?(t=t.slice(1),(e=LatexCmds[t])&&(t=e(t),i.selection&&t.replaces(i.replaceSelection()),t.createLeftOf(i.show()),this.__controller.scrollHoriz())):i.parent.write(i,t),n.blurred&&i.hide().parent.blur(),this},t.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[L];)t.selectLeft();return this},t.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},t.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},t.moveToLeftEnd=function(){return this.moveToDirEnd(L)},t.moveToRightEnd=function(){return this.moveToDirEnd(R)},t.keystroke=function(t){var e;for(t=t.replace(/^\s+|\s+$/g,"").split(/\s+/),e=0;e<t.length;e+=1)this.__controller.keystroke(t[e],{preventDefault:noop});return this},t.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},t.dropEmbedded=function(t,e,n){var i,s=t-$(window).scrollLeft(),a=e-$(window).scrollTop(),r=document.elementFromPoint(s,a);this.__controller.seek($(r),t,e),i=Embed().setOptions(n),i.createLeftOf(this.__controller.cursor)},t.clickAt=function(t,e,n){n=n||document.elementFromPoint(t,e);var i=this.__controller,s=i.root;return jQuery.contains(s.jQ[0],n)||(n=s.jQ[0]),i.seek($(n),t+pageXOffset,e+pageYOffset),i.blurred&&this.focus(),this},t.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}}),e.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},e.EditableField.prototype=i.EditableField.prototype;for(a in API)!function(n,s){var a=i[n]=s(i);e[n]=function(i,s){var r,o=e(i);return o instanceof a||!i||!i.nodeType?o:(r=Controller(a.RootBlock(),$(i),Options()),r.KIND_OF_MQ=n,a(r).__mathquillify(s,t))},e[n].prototype=a.prototype}(a,API[a]);return e}function RootBlockMixin(t){var e,n="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" ");for(e=0;e<n.length;e+=1)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(n[e]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function makeTextBlock(t,e,n){return P(TextBlock,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}function insLeftOfMeUnlessAtEnd(t){var e=this.parent,n=t;do{if(n[R])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function DelimsMixin(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));scale(this.delimjQs,min(1+.2*(t-1),1.2),1.2*t)}}function bindCharBracketPair(t,e){var e=e||t,n=OPP_BRACKS[t],i=OPP_BRACKS[e];CharCmds[t]=bind(Bracket,L,t,n,e,i),CharCmds[n]=bind(Bracket,R,t,n,e,i)}var undefined,__slice,send,P,L,R,Point,Node,Fragment,LatexCmds,CharCmds,Cursor,Selection,Controller,API,Options,optionProcessors,Progenote,EMBEDS,MIN,MAX,saneKeyboardEvents,Parser,latexMathParser,MathElement,MathCommand,Symbol,VanillaSymbol,BinaryOperator,MathBlock,RootMathBlock,TextBlock,TextPiece,RootMathCommand,RootTextBlock,LatexCommandInput,scale,forceIERedraw,div,div_style,transformPropNames,transformPropName,prop,Style,TextColor,Class,SupSub,SummationNotation,Fraction,LiveFraction,SquareRoot,Hat,NthRoot,DiacriticAbove,Bracket,OPP_BRACKS,Binomial,Choose,Embed,Digit,Variable,Letter,BuiltInOpNames,AutoOpNames,TwoWordOpNames,OperatorName,fn,NonSymbolaSymbol,LatexFragment,PlusMinus,Inequality,less,greater,Equality,MQ1,key,jQuery=require("jquery"),$=jQuery,mqCmdId="mathquill-command-id",mqBlockId="mathquill-block-id",min=Math.min,max=Math.max;if(!jQuery)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";__slice=[].slice,send=variadic(function(t,e){return variadic(function(n,i){if(t in n)return n[t].apply(n,e.concat(i))})}),P=function(t,e,n){function i(t){return"object"==typeof t}function s(t){return"function"==typeof t}function a(){}return function t(n,r){function o(){var t=new l;return s(t.init)&&t.init.apply(t,arguments),t}function l(){}var d,c,u;return void 0===r&&(r=n,n=Object),o.Bare=l,d=a.prototype=n.prototype,c=l.prototype=o.prototype=o.p=new a,c.constructor=o,o.extend=function(e){return t(o,e)},(o.open=function(t){if(u={},s(t)?u=t.call(o,c,d,o,n):i(t)&&(u=t),i(u))for(var a in u)e.call(u,a)&&(c[a]=u[a]);return s(c.init)||(c.init=n),o})(r)}}(0,{}.hasOwnProperty),L=-1,R=1,$=P(jQuery,function(t){t.insDirOf=function(t,e){return t===L?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===L?this.prependTo(e):this.appendTo(e)}}),Point=P(function(t){t.parent=0,t[L]=0,t[R]=0,t.init=function(t,e,n){this.parent=t,this[L]=e,this[R]=n},this.copy=function(t){return Point(t.parent,t[L],t[R])}}),Node=P(function(t){function e(){return n+=1}t[L]=0,t[R]=0,t.parent=0;var n=0;this.byId={},t.init=function(){this.id=e(),Node.byId[this.id]=this,this.ends={},this.ends[L]=0,this.ends[R]=0},t.dispose=function(){delete Node.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=$(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){function e(t){var n,i;for(t.getAttribute&&(n=t.getAttribute("mathquill-command-id"),i=t.getAttribute("mathquill-block-id"),n&&Node.byId[n].jQadd(t),i&&Node.byId[i].jQadd(t)),t=t.firstChild;t;t=t.nextSibling)e(t)}var n;for(t=$(t||this.html()),n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){prayDirection(t);var n=this;return n.jQize(),n.jQ.insDirOf(t,e.jQ),e[t]=n.adopt(e.parent,e[L],e[R]),n},t.createLeftOf=function(t){return this.createDir(L,t)},t.selectChildren=function(t,e){return Selection(t,e)},t.bubble=iterator(function(t){var e;for(e=this;e&&!1!==t(e);e=e.parent);return this}),t.postOrder=iterator(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[L]&&0===this.ends[R]},t.isStyleBlock=function(){return!1},t.children=function(){return Fragment(this.ends[L],this.ends[R])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return Fragment(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return Fragment(this,this).adopt(t,e,n),this},t.disown=function(){return Fragment(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),Fragment=P(function(t){t.init=function(t,e,n){if(n===undefined&&(n=L),prayDirection(n),pray("no half-empty fragments",!t==!e),this.ends={},t){pray("withDir is passed to Fragment",t instanceof Node),pray("oppDir is passed to Fragment",e instanceof Node),pray("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var i=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(i)}},t.jQ=$(),t.withDirAdopt=function(t,e,n,i){return t===L?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(t,e,n){var i,s,a;return prayWellFormed(t,e,n),i=this,i.disowned=!1,(s=i.ends[L])?(a=i.ends[R],e||(t.ends[L]=s),n?n[L]=a:t.ends[R]=a,i.ends[R][R]=n,i.each(function(n){n[L]=e,n.parent=t,e&&(e[R]=n),e=n}),i):this},t.disown=function(){var t,e,n=this,i=n.ends[L];return!i||n.disowned?n:(n.disowned=!0,t=n.ends[R],e=i.parent,prayWellFormed(e,i[L],i),prayWellFormed(e,t,t[R]),i[L]?i[L][R]=t[R]:e.ends[L]=t[R],t[R]?t[R][L]=i[L]:e.ends[R]=i[L],n)},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=iterator(function(t){var e=this,n=e.ends[L];if(!n)return e;for(;n!==e.ends[R][R]&&!1!==t(n);n=n[R]);return e}),t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),LatexCmds={},CharCmds={},Cursor=P(Point,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=$('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[R]?this.selection&&this.selection.ends[L][L]===this[L]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[R].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=$(),this},t.withDirInsertAt=function(t,e,n,i){var s=this.parent;this.parent=e,this[t]=n,this[-t]=i,s!==e&&s.blur&&s.blur(this)},t.insDirOf=function(t,e){return prayDirection(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(L,t)},t.insRightOf=function(t){return this.insDirOf(R,t)},t.insAtDirEnd=function(t,e){return prayDirection(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(L,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(R,t)},t.jumpUpDown=function(t,e){var n,i,s=this;s.upDownCache[t.id]=Point.copy(s),n=s.upDownCache[e.id],n?n[R]?s.insLeftOf(n[R]):s.insAtRightEnd(n.parent):(i=s.offset().left,e.seek(i,s))},t.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();return t.jQ.addClass("mq-cursor"),e},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[R],i=this,s=t[L];if(t.disown().eachChild(function(i){i.isEmpty()||(i.children().adopt(e,s,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),s=i.ends[R])}),!this[R])if(this[L])this[R]=this[L][R];else for(;!this[R];){if(this.parent=this.parent[R],!this.parent){this[R]=t[R],this.parent=e;break}this[R]=this.parent.ends[L]}this[R]?this.insLeftOf(this[R]):this.insAtRightEnd(e),t.jQ.remove(),t[L].siblingDeleted&&t[L].siblingDeleted(i.options,R),t[R].siblingDeleted&&t[R].siblingDeleted(i.options,L)},t.startSelection=function(){var t,e=this.anticursor=Point.copy(this),n=e.ancestors={};for(t=e;t.parent;t=t.parent)n[t.parent.id]=t},t.endSelection=function(){delete this.anticursor},t.select=function(){var t,e,n,i,s,a,r,o=this.anticursor;if(this[L]===o[L]&&this.parent===o.parent)return!1;for(t=this;t.parent;t=t.parent)if(t.parent.id in o.ancestors){e=t.parent;break}if(pray("cursor and anticursor in the same tree",e),n=o.ancestors[e.id],a=R,t[L]!==n)for(r=t;r;r=r[R])if(r[R]===n[R]){a=L,i=t,s=n;break}return a===R&&(i=n,s=t),i instanceof Point&&(i=i[R]),s instanceof Point&&(s=s[L]),this.hide().selection=e.selectChildren(i,s),this.insDirOf(a,this.selection.ends[a]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[L]=this.selection.ends[L][L],this[R]=this.selection.ends[R][R],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[L]=t.ends[L][L],this[R]=t.ends[R][R],delete this.selection),t},t.depth=function(){for(var t=this,e=0;t=t.parent;)e+=t instanceof MathBlock?1:0;return e},t.isTooDeep=function(t){if(this.options.maxDepth!==undefined)return this.depth()+(t||0)>this.options.maxDepth}}),Selection=P(Fragment,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),Controller=P(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,t.controller=this,this.cursor=t.cursor=Cursor(t,n)},t.handle=function(t,e){var n,i=this.options.handlers;i&&i.fns[t]&&(n=i.APIClasses[this.KIND_OF_MQ](this),e===L||e===R?i.fns[t](e,n):i.fns[t](n))};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}}),API={},Options=P(),optionProcessors={},Progenote=P(),EMBEDS={},MathQuill.prototype=Progenote.p,MathQuill.VERSION="v0.10.1",MathQuill.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return insistOnInterVer=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},insistOnInterVer(),MathQuill},MathQuill.getInterface=getInterface,MIN=getInterface.MIN=1,MAX=getInterface.MAX=2,MathQuill.noConflict=function(){return MathQuill},saneKeyboardEvents=function(){function t(t){var n,i=t.which||t.keyCode,s=e[i],a=[];return t.ctrlKey&&a.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&a.push("Meta"),t.altKey&&a.push("Alt"),t.shiftKey&&a.push("Shift"),n=s||String.fromCharCode(i),a.length||s?(a.push(n),a.join("-")):n}var e={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(e,n){function i(t){y=t,clearTimeout(f),f=setTimeout(t)}function s(t){i(function(e){y=noop,clearTimeout(f),t(e)})}function a(t){y(),y=noop,clearTimeout(f),C.val(t),t&&C[0].select&&C[0].select(),L=!!t}function r(){var t=C[0];return"selectionStart"in t&&t.selectionStart!==t.selectionEnd}function o(){n.keystroke(t(b),b)}function l(t){t.target===C[0]&&(b=t,x=null,L&&s(function(t){t&&"focusout"===t.type||!C[0].select||C[0].select()}),o())}function d(t){t.target===C[0]&&(b&&x&&o(),x=t,i(u))}function c(t){t.target===C[0]&&b&&!x&&i(u)}function u(){if(!r()){var t=C.val();1===t.length?(C.val(""),n.typedText(t)):t&&C[0].select&&C[0].select()}}function m(){b=x=null}function h(t){t.target===C[0]&&(document.activeElement!==C[0]&&C.focus(),i(p))}function p(){var t=C.val();C.val(""),t&&n.paste(t)}var f,L,b=null,x=null,C=jQuery(e),g=jQuery(n.container||C),y=noop;return g.bind("keydown keypress input keyup focusout paste",function(t){y(t)}),L=!1,g.bind({keydown:l,keypress:d,keyup:c,focusout:m,cut:function(){s(function(){n.cut()})},copy:function(){s(function(){n.copy()})},paste:h}),{select:a}}}(),Parser=P(function(t,e,n){function i(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}var s,a,r;t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(r)._(""+t,e,i)},t.or=function(t){pray("or is passed a parser",t instanceof n);var e=this;return n(function(n,i,s){function a(e){return t._(n,i,s)}return e._(n,i,a)})},t.then=function(t){var e=this;return n(function(i,s,a){function r(e,i){var r=t instanceof n?t:t(i);return pray("a parser is returned",r instanceof n),r._(e,s,a)}return e._(i,r,a)})},t.many=function(){var t=this;return n(function(e,n,i){function s(t,n){return e=t,r.push(n),!0}function a(){return!1}for(var r=[];t._(e,s,a););return n(e,r)})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,s,a){function r(t,e){return u.push(e),n=t,!0}function o(t,e){return d=e,n=t,!1}function l(t,e){return!1}var d,c,u=[],m=!0;for(c=0;c<t;c+=1)if(!(m=i._(n,r,o)))return a(n,d);for(;c<e&&m;c+=1)m=i._(n,r,l);return s(n,u)})},t.result=function(t){return this.then(a(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return a(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})},this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,s,a){var r=n.slice(0,e);return r===t?s(n.slice(e),r):a(n,i)})},s=this.regex=function(t){pray("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,i,s){var a,r=t.exec(n);return r?(a=r[0],i(n.slice(a.length),a)):s(n,e)})},a=n.succeed=function(t){return n(function(e,n){return n(e,t)})},n.fail=function(t){return n(function(e,n,i){return i(e,t)})},n.letter=s(/^[a-z]/i),n.letters=s(/^[a-z]*/i),n.digit=s(/^[0-9]/),n.digits=s(/^[0-9]*/),n.whitespace=s(/^\s+/),n.optWhitespace=s(/^\s*/),n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),n.all=n(function(t,e,n){return e("",t)}),r=n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})}),Controller.open(function(t){t.focusBlurEvents=function(){function t(){clearTimeout(n),a.selection&&a.selection.jQ.addClass("mq-blur"),e()}function e(){a.hide().parent.blur(),i.container.removeClass("mq-focused"),$(window).unbind("blur",t)}var n,i=this,s=i.root,a=i.cursor;i.textarea.focus(function(){i.blurred=!1,clearTimeout(n),i.container.addClass("mq-focused"),a.parent||a.insAtRightEnd(s),a.selection?(a.selection.jQ.removeClass("mq-blur"),i.selectionChanged()):a.show()}).blur(function(){i.blurred=!0,n=setTimeout(function(){s.postOrder("intentionalBlur"),a.clearSelection().endSelection(),e()}),$(window).bind("blur",t)}),i.blurred=!0,a.hide().parent.blur()},t.unbindFocusBlurEvents=function(){this.textarea.unbind("focus blur")}}),Controller.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),Controller.open(function(t){Options.p.ignoreNextMousedown=noop,t.delegateMouseEvents=function(){var t=this.root.jQ;this.container.bind("mousedown.mathquill",function(e){function n(t){a=$(t.target)}function i(t){d.anticursor||d.startSelection(),l.seek(a,t.pageX,t.pageY).cursor.select(),a=undefined}function s(t){d.blink=c,d.selection||(l.editable?d.show():u.detach()),r.unbind("mousemove",n),$(t.target.ownerDocument).unbind("mousemove",i).unbind("mouseup",s)}var a,r=$(e.target).closest(".mq-root-block"),o=Node.byId[r.attr(mqBlockId)||t.attr(mqBlockId)],l=o.controller,d=l.cursor,c=d.blink,u=l.textareaSpan,m=l.textarea;e.preventDefault(),e.target.unselectable=!0,d.options.ignoreNextMousedown(e)||(d.options.ignoreNextMousedown=noop,l.blurred&&(l.editable||r.prepend(u),m.focus()),d.blink=noop,l.seek($(e.target),e.pageX,e.pageY).cursor.startSelection(),r.mousemove(n),$(e.target.ownerDocument).mousemove(i).mouseup(s))})}}),Controller.open(function(t){t.seek=function(t,e,n){var i,s,a,r=this.notify("select").cursor;return t&&((i=t.attr(mqBlockId)||t.attr(mqCmdId))||(s=t.parent(),i=s.attr(mqBlockId)||s.attr(mqCmdId))),a=i?Node.byId[i]:this.root,pray("nodeId is the id of some Node that exists",a),r.clearSelection().show(),a.seek(e,r),this.scrollHoriz(),this}}),Controller.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),Node.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(L);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(R,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(L,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[R];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[R]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[L];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[L]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[L])for(;i[L];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[R])for(;i[R];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(R);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[L];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){pray("overridden or never called on this node")}}),Controller.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",s=e+"OutOf";return n[R][i]?n.insAtLeftEnd(n[R][i]):n[L][i]?n.insAtRightEnd(n[L][i]):n.parent.bubble(function(t){var e=t[s];if(e&&("function"==typeof e&&(e=t[s](n)),e instanceof Node&&n.jumpUpDown(t,e),!0!==e))return!1}),t}this.onNotify(function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()}),t.escapeDir=function(t,e,n){prayDirection(t);var i=this.cursor;if(i.parent!==this.root&&n.preventDefault(),i.parent!==this.root)return i.parent.moveOutOf(t,i),this.notify("move")},optionProcessors.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){prayDirection(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(L)},t.moveRight=function(){return this.moveDir(R)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){var e,n;return prayDirection(t),e=this.cursor,n=e.selection,this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[L].siblingDeleted&&e[L].siblingDeleted(e.options,R),e[R].siblingDeleted&&e[R].siblingDeleted(e.options,L),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){prayDirection(t);var e=this.cursor;return!e[t]||e.selection?this.deleteDir(t):(this.notify("edit"),t===L?Fragment(e.parent.ends[L],e[L]).remove():Fragment(e[R],e.parent.ends[R]).remove(),e.insAtDirEnd(t,e.parent),e[L].siblingDeleted&&e[L].siblingDeleted(e.options,R),e[R].siblingDeleted&&e[R].siblingDeleted(e.options,L),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(L)},t.deleteForward=function(){return this.deleteDir(R)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e,n=this.notify("select").cursor,i=n.selection;prayDirection(t),n.anticursor||n.startSelection(),e=n[t],e?i&&i.ends[t]===e&&n.anticursor[-t]!==e?e.unselectInto(t,n):e.selectTowards(t,n):n.parent.selectOutOf(t,n),n.clearSelection(),n.select()||n.show()},t.selectLeft=function(){return this.selectDir(L)},t.selectRight=function(){return this.selectDir(R)}}),Controller.open(function(t){Options.p.substituteTextarea=function(){return $("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},t.createTextarea=function(){var t,e=this.textareaSpan=$('<span class="mq-textarea"></span>'),n=this.options.substituteTextarea();if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;n=this.textarea=$(n).appendTo(e),t=this,t.cursor.selectionChanged=function(){t.selectionChanged()}},t.selectionChanged=function(){var t=this;forceIERedraw(t.container[0]),t.textareaSelectionTimeout===undefined&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=undefined;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){function t(){s.detach(),e.blurred=!0}var e=this,n=(e.root,e.cursor),i=e.textarea,s=e.textareaSpan;this.container.prepend(jQuery('<span class="mq-selectable">').text("$"+e.exportLatex()+"$")),e.blurred=!0,i.bind("cut paste",!1).bind("copy",function(){e.setTextareaSelection()}).focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){i.val(t),t&&i.select()}},Options.p.substituteKeyboardEvents=saneKeyboardEvents,t.editablesTextareaEvents=function(){var t=this,e=t.textarea,n=t.textareaSpan,i=this.options.substituteKeyboardEvents(e,this);this.selectFn=function(t){i.select(t)},this.container.prepend(n),this.focusBlurEvents()},t.unbindEditablesEvents=function(){var t=this,e=t.textarea,n=t.textareaSpan;this.selectFn=function(t){e.val(t),t&&e.select()},n.remove(),this.unbindFocusBlurEvents(),t.blurred=!0,e.bind("cut paste",!1)},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},t.cut=function(){var t=this,e=t.cursor;e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})},t.copy=function(){this.setTextareaSelection()},t.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}),latexMathParser=function(){function t(t){var e=MathBlock();return t.adopt(e,0,0),e}function e(t){var e,n=t[0]||MathBlock();for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[R],0);return n}var n=Parser.string,i=Parser.regex,s=Parser.letter,a=Parser.any,r=Parser.optWhitespace,o=Parser.succeed,l=Parser.fail,d=s.map(function(t){return Letter(t)}),c=i(/^[^${}\\_^]/).map(function(t){return VanillaSymbol(t)}),u=i(/^[^\\a-eg-zA-Z]/).or(n("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(a))).then(function(t){var e=LatexCmds[t];return e?e(t).parser():l("unknown command: \\"+t)}),m=u.or(d).or(c),h=n("{").then(function(){return f}).skip(n("}")),p=r.then(h.or(m.map(t))),f=p.many().map(e).skip(r),L=n("[").then(p.then(function(t){return"]"!==t.join("latex")?o(t):l()}).many().map(e).skip(r)).skip(n("]")),b=f;return b.block=p,b.optBlock=L,b}(),Controller.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},optionProcessors.maxDepth=function(t){return"number"==typeof t?t:undefined},t.writeLatex=function(t){var e=this.notify("edit").cursor;return e.parent.writeLatex(e,t),this},t.renderLatexMath=function(t){var e,n=this.root,i=this.cursor,s=(i.options,n.jQ),a=Parser.all,r=Parser.eof,o=latexMathParser.skip(r).or(a.result(!1)).parse(t);n.eachChild("postOrder","dispose"),n.ends[L]=n.ends[R]=0,o&&o.prepareInsertionAt(i)?(o.children().adopt(n,0,0),e=o.join("html"),s.html(e),n.jQize(s.children()),n.finalizeInsert(i.options)):s.empty(),delete i.selection,i.insAtRightEnd(n)},t.renderLatexText=function(t){var e,n,i,s,a,r,o,l,d,c,u=this.root,m=this.cursor;if(u.jQ.children().slice(1).remove(),u.eachChild("postOrder","dispose"),u.ends[L]=u.ends[R]=0,delete m.selection,m.show().insAtRightEnd(u),e=Parser.regex,n=Parser.string,i=Parser.eof,s=Parser.all,a=n("$").then(latexMathParser).skip(n("$").or(i)).map(function(t){var e,n=RootMathCommand(m);return n.createBlocks(),e=n.ends[L],t.children().adopt(e,0,0),n}),r=n("\\$").result("$"),o=r.or(e(/^[^$]/)).map(VanillaSymbol),l=a.or(o).many(),d=l.skip(i).or(s.result(!1)).parse(t)){for(c=0;c<d.length;c+=1)d[c].adopt(u,u.ends[R],0);u.jQize().appendTo(u.jQ),
u.finalizeInsert(m.options)}}}),Controller.open(function(t){t.scrollHoriz=function(){var t,e,n,i,s,a=this.cursor,r=a.selection,o=this.root.jQ[0].getBoundingClientRect();if(r)if(n=r.jQ[0].getBoundingClientRect(),i=n.left-(o.left+20),s=n.right-(o.right-20),r.ends[L]===a[R])if(i<0)e=i;else{if(!(s>0))return;e=n.left-s<o.left+20?i:s}else if(s>0)e=s;else{if(!(i<0))return;e=n.right-i>o.right-20?s:i}else if((t=a.jQ[0].getBoundingClientRect().left)>o.right-20)e=t-(o.right-20);else{if(!(t<o.left+20))return;e=t-(o.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+e},100)}}),MathElement=P(Node,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[R].siblingCreated&&n[R].siblingCreated(t,L),n[L].siblingCreated&&n[L].siblingCreated(t,R),n.bubble("reflow")},t.prepareInsertionAt=function(t){var e,n=t.options.maxDepth;if(n!==undefined){if((e=t.depth())>n)return!1;this.removeNodesDeeperThan(n-e)}return!0},t.removeNodesDeeperThan=function(t){for(var e,n=0,i=[[this,n]];i.length;)e=i.shift(),e[0].children().each(function(s){var a=s instanceof MathBlock?1:0;n=e[1]+a,n<=t?i.push([s,n]):(a?s.children():s).remove()})}}),MathCommand=P(MathElement,function(t,e){t.init=function(t,n,i){var s=this;e.init.call(s),s.ctrlSeq||(s.ctrlSeq=t),n&&(s.htmlTemplate=n),i&&(s.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=latexMathParser.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[R],0);return e})},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[L],0,0),i.jQ.appendTo(n.ends[L].jQ),n.placeCursor(t),n.prepareInsertionAt(t)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){var t,e,n=this,i=n.numBlocks(),s=n.blocks=Array(i);for(t=0;t<i;t+=1)e=s[t]=MathBlock(),e.adopt(n,n.ends[R],0)},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[L],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return Selection(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[L]=t.jQ.offset().left,e[R]=e[L]+t.jQ.outerWidth(),e}var i,s=this,a=n(s);return t<a[L]?e.insLeftOf(s):t>a[R]?e.insRightOf(s):(i=a[L],void s.eachChild(function(r){var o=n(r);return t<o[L]?(t-i<o[L]-t?r[L]?e.insAtRightEnd(r[L]):e.insLeftOf(s):e.insAtLeftEnd(r),!1):t>o[R]?void(r[R]?i=o[R]:a[R]-t<t-o[R]?e.insRightOf(s):e.insAtRightEnd(r)):(r.seek(t,e),!1)}))},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t,e,n,i=this,s=i.blocks,a=" mathquill-command-id="+i.id,r=i.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(pray("no unmatched angle brackets",r.join("")===this.htmlTemplate),t=0,e=r[0];e;t+=1,e=r[t])if("/>"===e.slice(-2))r[t]=e.slice(0,-2)+a+"/>";else if("<"===e.charAt(0)){pray("not an unmatched top-level close tag","/"!==e.charAt(1)),r[t]=e.slice(0,-1)+a+">",n=1;do{t+=1,e=r[t],pray("no missing close tags",e),"</"===e.slice(0,2)?n-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(n+=1)}while(n>0)}return r.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+s[e].id+">"+s[e].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e+=1;var s=i.text();return n&&"("===t.textTemplate[e]&&"("===s[0]&&")"===s.slice(-1)?n+s.slice(1,-1)+t.textTemplate[e]:n+s+(t.textTemplate[e]||"")})}}),Symbol=P(MathCommand,function(t,e){t.init=function(t,n,i){i||(i=t&&t.length>1?t.slice(1):t),e.init.call(this,t,n,[i])},t.parser=function(){return Parser.succeed(this)},t.numBlocks=function(){return 0},t.replaces=function(t){t.remove()},t.createBlocks=noop,t.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},t.deleteTowards=function(t,e){e[t]=this.remove()[t]},t.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},t.latex=function(){return this.ctrlSeq},t.text=function(){return this.textTemplate},t.placeCursor=noop,t.isEmpty=function(){return!0}}),VanillaSymbol=P(Symbol,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}}),BinaryOperator=P(Symbol,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i)}}),MathBlock=P(MathElement,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[L]===this.ends[R]&&0!==this.ends[L]?this.ends[L].text():this.join("text")},t.keystroke=function(t,n,i){return!i.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?L:R,t,n))},t.moveOutOf=function(t,e,n){n&&this.parent[n+"Into"]||!this[t]?e.insDirOf(t,this.parent):e.insAtDirEnd(-t,this[t])},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[R];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[L].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[L];return n.seek(t,e)},t.chToCmd=function(t,e){var n;return t.match(/^[a-eg-zA-Z]$/)?Letter(t):/^\d$/.test(t)?Digit(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?LatexCmds["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?LatexCmds["×"](t):(n=CharCmds[t]||LatexCmds[t])?n(t):VanillaSymbol(t)},t.write=function(t,e){var n=this.chToCmd(e,t.options);t.selection&&n.replaces(t.replaceSelection()),t.isTooDeep()||n.createLeftOf(t.show())},t.writeLatex=function(t,e){var n,i=Parser.all,s=Parser.eof,a=latexMathParser.skip(s).or(i.result(!1)).parse(e);a&&!a.isEmpty()&&a.prepareInsertionAt(t)&&(a.children().adopt(t.parent,t[L],t[R]),n=a.jQize(),n.insertBefore(t.jQ),t[L]=a.ends[R],a.finalizeInsert(t.options,t),a.ends[R][R].siblingCreated&&a.ends[R][R].siblingCreated(t.options,L),a.ends[L][L].siblingCreated&&a.ends[L][L].siblingCreated(t.options,R),t.parent.bubble("reflow"))},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),Options.p.mouseEvents=!0,API.StaticMath=function(t){return P(t.AbstractMathQuill,function(e,n){this.RootBlock=MathBlock,e.__mathquillify=function(t,e){return this.config(t),n.__mathquillify.call(this,"mq-math-mode"),this.__options.mouseEvents&&(this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.InnerMathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.InnerMathField),e}})},RootMathBlock=P(MathBlock,RootBlockMixin),API.MathField=function(t){return P(t.EditableField,function(t,e){this.RootBlock=RootMathBlock,t.__mathquillify=function(t,n){return this.config(t),n>1&&(this.__controller.root.reflow=noop),e.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},API.InnerMathField=function(t){return P(t.MathField,function(t,e){t.makeStatic=function(){this.__controller.editable=!1,this.__controller.root.blur(),this.__controller.unbindEditablesEvents(),this.__controller.container.removeClass("mq-editable-field")},t.makeEditable=function(){this.__controller.editable=!0,this.__controller.editablesTextareaEvents(),this.__controller.cursor.insAtRightEnd(this.__controller.root),this.__controller.container.addClass("mq-editable-field")}})},TextBlock=P(Node,function(t,e){function n(t){var e,n;if(t.jQ[0].normalize(),e=t.jQ[0].firstChild)return pray("only node in TextBlock span is Text node",3===e.nodeType),n=TextPiece(e.data),n.jQadd(e),t.children().disown(),n.adopt(t,0,0)}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof Fragment?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[L]&&this.ends[L].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var n,i=this;if(e.createLeftOf.call(this,t),t.insAtRightEnd(i),i.replacedText)for(n=0;n<i.replacedText.length;n+=1)i.write(t,i.replacedText.charAt(n));i[R].siblingCreated&&i[R].siblingCreated(t.options,L),i[L].siblingCreated&&i[L].siblingCreated(t.options,R),i.bubble("reflow")},t.parser=function(){var t=this,e=Parser.string,n=Parser.regex;return Parser.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return 0===e.length?Fragment():(TextPiece(e).adopt(t,0,0),t)})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){var t=this.textContents();return 0===t.length?"":"\\text{"+t.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=MathCommand.prototype.selectTowards,t.deleteTowards=MathCommand.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n){var i,s;t.show().deleteSelection(),"$"!==n?t[L]?t[L].appendText(n):TextPiece(n).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),VanillaSymbol("\\$","$").createLeftOf(t)):t[R]?t[L]?(i=TextBlock(),s=this.ends[L],s.disown().jQ.detach(),s.adopt(i,0,0),t.insLeftOf(this),e.createLeftOf.call(i,t)):t.insLeftOf(this):t.insRightOf(this),this.bubble("reflow")},t.writeLatex=function(t,e){t[L]?t[L].appendText(e):TextPiece(e).createLeftOf(t),this.bubble("reflow")},t.seek=function(t,e){var i,s,a,r,o,l,d,c;for(e.hide(),i=n(this),s=this.jQ.width()/this.text.length,a=Math.round((t-this.jQ.offset().left)/s),a<=0?e.insAtLeftEnd(this):a>=i.text.length?e.insAtRightEnd(this):e.insLeftOf(i.splitRight(a)),r=t-e.show().offset().left,o=r&&r<0?L:R,l=o;e[o]&&r*l>0;)e[o].moveTowards(o,e),l=r,r=t-e.offset().left;o*r<-o*l&&e[-o].moveTowards(-o,e),e.anticursor?e.anticursor.parent===this&&(d=e[L]&&e[L].text.length,this.anticursorPosition===d?e.anticursor=Point.copy(e):(this.anticursorPosition<d?(c=e[L].splitRight(this.anticursorPosition),e[L]=c):c=e[R].splitRight(this.anticursorPosition-d),e.anticursor=Point(this,c[L],c))):this.anticursorPosition=e[L]&&e[L].text.length},t.blur=function(t){MathBlock.prototype.blur.call(this),t&&(""===this.textContents()?(this.remove(),t[L]===this?t[L]=this[L]:t[R]===this&&(t[R]=this[R])):n(this))},t.focus=MathBlock.prototype.focus}),TextPiece=P(Node,function(t,e){function n(t,e){return e.charAt(t===L?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=$(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){prayDirection(e),e===R?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=TextPiece(this.text.slice(t)).adopt(this.parent,this,this[R]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){var i,s;return prayDirection(t),i=n(-t,this.text),s=this[-t],s?s.insTextAtDirEnd(i,t):TextPiece(i).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?t===R?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){var i,s,a,r;return prayDirection(t),i=e.anticursor,s=n(-t,this.text),i[t]===this?(a=TextPiece(s).createDir(t,e),i[t]=a,e.insDirOf(t,a)):(r=this[-t],r?r.insTextAtDirEnd(s,t):(a=TextPiece(s).createDir(-t,e),a.jQ.insDirOf(-t,e.selection.jQ)),1===this.text.length&&i[-t]===this&&(i[-t]=this[-t])),this.deleteTowards(t,e)}}),LatexCmds.text=LatexCmds.textnormal=LatexCmds.textrm=LatexCmds.textup=LatexCmds.textmd=TextBlock,LatexCmds.em=LatexCmds.italic=LatexCmds.italics=LatexCmds.emph=LatexCmds.textit=LatexCmds.textsl=makeTextBlock("\\textit","i",'class="mq-text-mode"'),LatexCmds.strong=LatexCmds.bold=LatexCmds.textbf=makeTextBlock("\\textbf","b",'class="mq-text-mode"'),LatexCmds.sf=LatexCmds.textsf=makeTextBlock("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),LatexCmds.tt=LatexCmds.texttt=makeTextBlock("\\texttt","span",'class="mq-monospace mq-text-mode"'),LatexCmds.textsc=makeTextBlock("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),LatexCmds.uppercase=makeTextBlock("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),LatexCmds.lowercase=makeTextBlock("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),RootMathCommand=P(MathCommand,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[L].cursor=this.cursor,this.ends[L].write=function(t,e){"$"!==e?MathBlock.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),VanillaSymbol("\\$","$").createLeftOf(t.show())):t[R]?t[L]?MathBlock.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[L].latex()+"$"}}),RootTextBlock=P(RootMathBlock,function(t,e){t.keystroke=function(t){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return e.keystroke.apply(this,arguments)},t.write=function(t,e){if(t.show().deleteSelection(),"$"===e)RootMathCommand(t).createLeftOf(t);else{var n;"<"===e?n="&lt;":">"===e&&(n="&gt;"),VanillaSymbol(e,n).createLeftOf(t)}}}),API.TextField=function(t){return P(t.EditableField,function(t,e){this.RootBlock=RootTextBlock,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},LatexCommandInput=CharCmds["\\"]=P(MathCommand,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[L].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[L].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[L].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?VanillaSymbol(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||t.parent.write(t,e))},this.ends[L].keystroke=function(t,n,i){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(i.cursor),void n.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return $(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[L].latex()+" "},t.renderCommand=function(t){var e,n;this.jQ=this.jQ.last(),this.remove(),this[R]?t.insLeftOf(this[R]):t.insAtRightEnd(this.parent),e=this.ends[L].latex(),e||(e=" "),n=LatexCmds[e],n?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):(n=TextBlock(),n.replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}}),forceIERedraw=noop,div=document.createElement("div"),div_style=div.style,transformPropNames={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(prop in transformPropNames)if(prop in div_style){transformPropName=prop;break}transformPropName?scale=function(t,e,n){t.css(transformPropName,"scale("+e+","+n+")")}:"filter"in div_style?(forceIERedraw=function(t){t.className=t.className},scale=function(t,e,n){function i(){t.css("marginRight",(s.width()-1)*(e-1)/e+"px")}var s,a;e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'),s=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')"),i(),a=setInterval(i),$(window).load(function(){clearTimeout(a),i()})}):scale=function(t,e,n){t.css("fontSize",n+"em")},Style=P(MathCommand,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}}),LatexCmds.mathrm=bind(Style,"\\mathrm","span",'class="mq-roman mq-font"'),LatexCmds.mathit=bind(Style,"\\mathit","i",'class="mq-font"'),LatexCmds.mathbf=bind(Style,"\\mathbf","b",'class="mq-font"'),LatexCmds.mathsf=bind(Style,"\\mathsf","span",'class="mq-sans-serif mq-font"'),LatexCmds.mathtt=bind(Style,"\\mathtt","span",'class="mq-monospace mq-font"'),LatexCmds.underline=bind(Style,"\\underline","span",'class="mq-non-leaf mq-underline"'),LatexCmds.overline=LatexCmds.bar=bind(Style,"\\overline","span",'class="mq-non-leaf mq-overline"'),LatexCmds.overrightarrow=bind(Style,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),LatexCmds.overleftarrow=bind(Style,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),LatexCmds.overleftrightarrow=bind(Style,"\\overleftrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-both"'),LatexCmds.overarc=bind(Style,"\\overarc","span",'class="mq-non-leaf mq-overarc"'),LatexCmds.dot=P(MathCommand,function(t,e){t.init=function(){e.init.call(this,"\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')}}),TextColor=LatexCmds.textcolor=P(MathCommand,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=Parser.optWhitespace,i=Parser.string,s=Parser.regex;return n.then(i("{")).then(s(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(n){return t.setColor(n),e.parser.call(t)})},t.isStyleBlock=function(){return!0}}),Class=LatexCmds.class=P(MathCommand,function(t,e){t.parser=function(){var t=this,n=Parser.string,i=Parser.regex;return Parser.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.cls=n||"",t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})},t.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},t.isStyleBlock=function(){return!0}}),SupSub=P(MathCommand,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){if(this.replacedFragment||t[L]||!t.options.supSubsRequireOperand)return e.createLeftOf.apply(this,arguments)},t.contactWeld=function(t){var e,n,i,s,a,r;for(e=L;e;e=e===L&&R)if(this[e]instanceof SupSub){for(n="sub";n;n="sub"===n&&"sup")i=this[n],s=this[e][n],i&&(s?i.isEmpty()?r=Point(s,0,s.ends[L]):(i.jQ.children().insAtDirEnd(-e,s.jQ),a=i.children().disown(),r=Point(s,a.ends[R],s.ends[L]),e===L?a.adopt(s,s.ends[R],0):a.adopt(s,0,s.ends[L])):this[e].addBlock(i.disown()),this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(s,i));this.remove(),t&&t[L]===this&&(e===R&&r?r[L]?t.insRightOf(r[L]):t.insAtLeftEnd(r.parent):t.insRightOf(this[e]));break}},Options.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[L].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e,t.options);return n instanceof Symbol?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show())}t[L]&&!t[R]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),MathBlock.p.write.apply(this,arguments)}},t.moveTowards=function(t,n,i){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];i instanceof Symbol?i.remove():i&&i.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(L,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.text=function(){function t(t,e){var n=e&&e.text();return e?t+(1===n.length?n:"("+(n||" ")+")"):""}return t("_",this.sub)+t("^",this.sup)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=$('<span class="mq-sup"/>').append(t.jQ.children()).attr(mqBlockId,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=$('<span class="mq-sub"></span>').append(t.jQ.children()).attr(mqBlockId,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e+=1)!function(t,e,n,i){t[e].deleteOutOf=function(s,a){if(a.insDirOf(this[s]?-s:s,this.parent),!this.isEmpty()){var r=this.ends[s];this.children().disown().withDirAdopt(s,a.parent,a[s],a[-s]).jQ.insDirOf(-s,a.jQ),a[-s]=r}t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=insLeftOfMeUnlessAtEnd,delete t[n].deleteOutOf,"sub"===e&&$(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])},t.reflow=function(){var t,e,n,i,s,a=this.jQ,r=a.prev();r.length&&(t=a.children(".mq-sup"),t.length&&(e=parseInt(t.css("font-size")),n=t.offset().top+t.height(),i=n-r.offset().top-.7*e,s=parseInt(t.css("margin-bottom")),t.css("margin-bottom",s+i)))}}),LatexCmds.subscript=LatexCmds._=P(SupSub,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[L],this.sub.upOutOf=insLeftOfMeUnlessAtEnd,e.finalizeTree.call(this)}}),LatexCmds.superscript=LatexCmds.supscript=LatexCmds["^"]=P(SupSub,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^(",")"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[R],this.sup.downOutOf=insLeftOfMeUnlessAtEnd,e.finalizeTree.call(this)}}),SummationNotation=P(MathCommand,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';Symbol.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(Letter("n").createLeftOf(t),Equality().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[L].latex())+"^"+t(this.ends[R].latex())},t.parser=function(){var t,e=Parser.string,n=Parser.optWhitespace,i=Parser.succeed,s=latexMathParser.block,a=this,r=a.blocks=[MathBlock(),MathBlock()];for(t=0;t<r.length;t+=1)r[t].adopt(a,a.ends[R],0);return n.then(e("_").or(e("^"))).then(function(t){var e=r["_"===t?0:1];return s.then(function(t){return t.children().adopt(e,e.ends[R],0),i(a)})}).many().result(a)},t.finalizeTree=function(){this.downInto=this.ends[L],this.upInto=this.ends[R],this.ends[L].upOutOf=this.ends[R],this.ends[R].downOutOf=this.ends[L]}}),LatexCmds["∑"]=LatexCmds.sum=LatexCmds.summation=bind(SummationNotation,"\\sum ","&sum;"),LatexCmds["∏"]=LatexCmds.prod=LatexCmds.product=bind(SummationNotation,"\\prod ","&prod;"),LatexCmds.coprod=LatexCmds.coproduct=bind(SummationNotation,"\\coprod ","&#8720;"),LatexCmds["∫"]=LatexCmds.int=LatexCmds.integral=P(SummationNotation,function(t,e){t.init=function(){Symbol.prototype.init.call(this,"\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=MathCommand.p.createLeftOf}),Fraction=LatexCmds.frac=LatexCmds.dfrac=LatexCmds.cfrac=LatexCmds.fraction=P(MathCommand,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[R].upOutOf=this.ends[L],this.downInto=this.ends[L].downOutOf=this.ends[R]}}),LiveFraction=LatexCmds.over=CharCmds["/"]=P(Fraction,function(t,e){t.createLeftOf=function(t){if(!this.replacedFragment){for(var n=t[L];n&&!(n instanceof BinaryOperator||n instanceof(LatexCmds.text||noop)||n instanceof SummationNotation||"\\ "===n.ctrlSeq||/^[,;:]$/.test(n.ctrlSeq));)n=n[L];n instanceof SummationNotation&&n[R]instanceof SupSub&&(n=n[R],n[R]instanceof SupSub&&n[R].ctrlSeq!=n.ctrlSeq&&(n=n[R])),n===t[L]||t.isTooDeep(1)||(this.replaces(Fragment(n[R]||t.parent.ends[L],t[L])),t[L]=n)}e.createLeftOf.call(this,t)}}),SquareRoot=LatexCmds.sqrt=LatexCmds["√"]=P(MathCommand,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return latexMathParser.optBlock.then(function(t){return latexMathParser.block.map(function(e){var n=NthRoot();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[R].jQ;scale(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),Hat=LatexCmds.hat=P(MathCommand,function(t,e){t.ctrlSeq="\\hat",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',t.textTemplate=["hat(",")"]}),NthRoot=LatexCmds.nthroot=P(SquareRoot,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[L].latex()+"]{"+this.ends[R].latex()+"}"}}),DiacriticAbove=P(MathCommand,function(t,e){t.init=function(t,n,i){var s='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+n+'</span><span class="mq-diacritic-stem">&0</span></span>';e.init.call(this,t,s,i)}}),LatexCmds.vec=bind(DiacriticAbove,"\\vec","&rarr;",["vec(",")"]),LatexCmds.tilde=bind(DiacriticAbove,"\\tilde","~",["tilde(",")"]),Bracket=P(P(MathCommand,DelimsMixin),function(t,e){t.init=function(t,n,i,s,a){e.init.call(this,"\\left"+s,undefined,[n,i]),this.side=t,this.sides={},this.sides[L]={ch:n,ctrlSeq:s},this.sides[R]={ch:i,ctrlSeq:a}},t.numBlocks=function(){return 1},t.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===R?" mq-ghost":"")+'">'+this.sides[L].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===L?" mq-ghost":"")+'">'+this.sides[R].ch+"</span></span>",e.html.call(this)},t.latex=function(){return"\\left"+this.sides[L].ctrlSeq+this.ends[L].latex()+"\\right"+this.sides[R].ctrlSeq},t.matchBrack=function(t,e,n){return n instanceof Bracket&&n.side&&n.side!==-e&&(!t.restrictMismatchedBrackets||OPP_BRACKS[this.sides[this.side].ch]===n.sides[n.side].ch||{"(":"]","[":")"}[this.sides[L].ch]===n.sides[R].ch)&&n},t.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===L?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},t.createLeftOf=function(t){var n,i,s;this.replacedFragment||(n=t.options,i="|"===this.sides[L].ch?this.matchBrack(n,R,t[R])||this.matchBrack(n,L,t[L])||this.matchBrack(n,0,t.parent.parent):this.matchBrack(n,-this.side,t[-this.side])||this.matchBrack(n,-this.side,t.parent.parent)),i?(s=this.side=-i.side,this.closeOpposing(i),i===t.parent.parent&&t[s]&&Fragment(t[s],t.parent.ends[s],-s).disown().withDirAdopt(-s,i.parent,i,i[s]).jQ.insDirOf(s,i.jQ),i.bubble("reflow")):(i=this,s=i.side,i.replacedFragment?i.side=0:t[-s]&&(i.replaces(Fragment(t[-s],t.parent.ends[-s],s)),t[-s]=0),e.createLeftOf.call(i,t)),s===L?t.insAtLeftEnd(i.ends[L]):t.insRightOf(i)},t.placeCursor=noop,t.unwrap=function(){this.ends[L].children().disown().adopt(this.parent,this,this[R]).jQ.insertAfter(this.jQ),this.remove()},t.deleteSide=function(t,e,n){var i,s,a,r=this.parent,o=this[t],l=r.ends[t];if(t===this.side)return this.unwrap(),void(o?n.insDirOf(-t,o):n.insAtDirEnd(t,r));if(i=n.options,s=!this.side,this.side=-t,this.matchBrack(i,t,this.ends[L].ends[this.side]))this.closeOpposing(this.ends[L].ends[this.side]),a=this.ends[L].ends[t],this.unwrap(),a.siblingCreated&&a.siblingCreated(n.options,t),o?n.insDirOf(-t,o):n.insAtDirEnd(t,r);else{if(this.matchBrack(i,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&s)return this.unwrap(),void(o?n.insDirOf(-t,o):n.insAtDirEnd(t,r));this.sides[t]={ch:OPP_BRACKS[this.sides[this.side].ch],ctrlSeq:OPP_BRACKS[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===L?0:1).addClass("mq-ghost").html(this.sides[t].ch)}o?(a=this.ends[L].ends[t],Fragment(o,l,-t).disown().withDirAdopt(-t,this.ends[L],a,0).jQ.insAtDirEnd(t,this.ends[L].jQ.removeClass("mq-empty")),a.siblingCreated&&a.siblingCreated(n.options,t),n.insDirOf(-t,o)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[L])}},t.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},t.finalizeTree=function(){this.ends[L].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===L?1:0).removeClass("mq-ghost"),this.side=0}},t.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),OPP_BRACKS={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},bindCharBracketPair("("),bindCharBracketPair("["),bindCharBracketPair("{","\\{"),LatexCmds.langle=bind(Bracket,L,"&lang;","&rang;","\\langle ","\\rangle "),
LatexCmds.rangle=bind(Bracket,R,"&lang;","&rang;","\\langle ","\\rangle "),CharCmds["|"]=bind(Bracket,L,"|","|","|","|"),LatexCmds.lVert=bind(Bracket,L,"&#8741;","&#8741;","\\lVert ","\\rVert "),LatexCmds.rVert=bind(Bracket,R,"&#8741;","&#8741;","\\lVert ","\\rVert "),LatexCmds.left=P(MathCommand,function(t){t.parser=function(){var t=Parser.regex,e=Parser.string,n=(Parser.succeed,Parser.optWhitespace);return n.then(t(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then(function(i){var s="\\"===i.charAt(0)?i.slice(1):i;return"\\langle"==i&&(s="&lang;",i+=" "),"\\lVert"==i&&(s="&#8741;",i+=" "),latexMathParser.then(function(a){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map(function(t){var e,n="\\"===t.charAt(0)?t.slice(1):t;return"\\rangle"==t&&(n="&rang;",t+=" "),"\\rVert"==t&&(n="&#8741;",t+=" "),e=Bracket(0,s,n,i,t),e.blocks=[a],a.adopt(e,0,0),e})})})}}),LatexCmds.right=P(MathCommand,function(t){t.parser=function(){return Parser.fail("unmatched \\right")}}),Binomial=LatexCmds.binom=LatexCmds.binomial=P(P(MathCommand,DelimsMixin),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]}),Choose=LatexCmds.choose=P(Binomial,function(t){t.createLeftOf=LiveFraction.prototype.createLeftOf}),LatexCmds.editable=LatexCmds.MathQuillMathField=P(MathCommand,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=Parser.string,i=Parser.regex,s=Parser.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(s()).then(e.parser.call(t))},t.finalizeTree=function(t){var e=Controller(this.ends[L],this.jQ,t);e.KIND_OF_MQ="MathField",e.editable=!0,e.createTextarea(),e.editablesTextareaEvents(),e.cursor.insAtRightEnd(e.root),RootBlockMixin(e.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[L].controller))},t.latex=function(){return this.ends[L].latex()},t.text=function(){return this.ends[L].text()}}),Embed=LatexCmds.embed=P(Symbol,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this,e=Parser.string,n=Parser.regex,i=Parser.succeed;return e("{").then(n(/^[a-z][a-z0-9]*/i)).skip(e("}")).then(function(s){return e("[").then(n(/^[-\w\s]*/)).skip(e("]")).or(i()).map(function(e){return t.setOptions(EMBEDS[s](e))})})}}),LatexCmds.notin=LatexCmds.cong=LatexCmds.equiv=LatexCmds.oplus=LatexCmds.otimes=P(BinaryOperator,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),LatexCmds["≠"]=LatexCmds.ne=LatexCmds.neq=bind(BinaryOperator,"\\ne ","&ne;"),LatexCmds["∗"]=LatexCmds.ast=LatexCmds.star=LatexCmds.loast=LatexCmds.lowast=bind(BinaryOperator,"\\ast ","&lowast;"),LatexCmds.therefor=LatexCmds.therefore=bind(BinaryOperator,"\\therefore ","&there4;"),LatexCmds.cuz=LatexCmds.because=bind(BinaryOperator,"\\because ","&#8757;"),LatexCmds.prop=LatexCmds.propto=bind(BinaryOperator,"\\propto ","&prop;"),LatexCmds["≈"]=LatexCmds.asymp=LatexCmds.approx=bind(BinaryOperator,"\\approx ","&asymp;"),LatexCmds.isin=LatexCmds.in=bind(BinaryOperator,"\\in ","&isin;"),LatexCmds.ni=LatexCmds.contains=bind(BinaryOperator,"\\ni ","&ni;"),LatexCmds.notni=LatexCmds.niton=LatexCmds.notcontains=LatexCmds.doesnotcontain=bind(BinaryOperator,"\\not\\ni ","&#8716;"),LatexCmds.sub=LatexCmds.subset=bind(BinaryOperator,"\\subset ","&sub;"),LatexCmds.sup=LatexCmds.supset=LatexCmds.superset=bind(BinaryOperator,"\\supset ","&sup;"),LatexCmds.nsub=LatexCmds.notsub=LatexCmds.nsubset=LatexCmds.notsubset=bind(BinaryOperator,"\\not\\subset ","&#8836;"),LatexCmds.nsup=LatexCmds.notsup=LatexCmds.nsupset=LatexCmds.notsupset=LatexCmds.nsuperset=LatexCmds.notsuperset=bind(BinaryOperator,"\\not\\supset ","&#8837;"),LatexCmds.sube=LatexCmds.subeq=LatexCmds.subsete=LatexCmds.subseteq=bind(BinaryOperator,"\\subseteq ","&sube;"),LatexCmds.supe=LatexCmds.supeq=LatexCmds.supsete=LatexCmds.supseteq=LatexCmds.supersete=LatexCmds.superseteq=bind(BinaryOperator,"\\supseteq ","&supe;"),LatexCmds.nsube=LatexCmds.nsubeq=LatexCmds.notsube=LatexCmds.notsubeq=LatexCmds.nsubsete=LatexCmds.nsubseteq=LatexCmds.notsubsete=LatexCmds.notsubseteq=bind(BinaryOperator,"\\not\\subseteq ","&#8840;"),LatexCmds.nsupe=LatexCmds.nsupeq=LatexCmds.notsupe=LatexCmds.notsupeq=LatexCmds.nsupsete=LatexCmds.nsupseteq=LatexCmds.notsupsete=LatexCmds.notsupseteq=LatexCmds.nsupersete=LatexCmds.nsuperseteq=LatexCmds.notsupersete=LatexCmds.notsuperseteq=bind(BinaryOperator,"\\not\\supseteq ","&#8841;"),LatexCmds.mathbb=P(MathCommand,function(t){t.createLeftOf=noop,t.numBlocks=function(){return 1},t.parser=function(){var t=Parser.string,e=Parser.regex,n=Parser.optWhitespace;return n.then(t("{")).then(n).then(e(/^[NPZQRCH]/)).skip(n).skip(t("}")).map(function(t){return LatexCmds[t]()})}}),LatexCmds.N=LatexCmds.naturals=LatexCmds.Naturals=bind(VanillaSymbol,"\\mathbb{N}","&#8469;"),LatexCmds.P=LatexCmds.primes=LatexCmds.Primes=LatexCmds.projective=LatexCmds.Projective=LatexCmds.probability=LatexCmds.Probability=bind(VanillaSymbol,"\\mathbb{P}","&#8473;"),LatexCmds.Z=LatexCmds.integers=LatexCmds.Integers=bind(VanillaSymbol,"\\mathbb{Z}","&#8484;"),LatexCmds.Q=LatexCmds.rationals=LatexCmds.Rationals=bind(VanillaSymbol,"\\mathbb{Q}","&#8474;"),LatexCmds.R=LatexCmds.reals=LatexCmds.Reals=bind(VanillaSymbol,"\\mathbb{R}","&#8477;"),LatexCmds.C=LatexCmds.complex=LatexCmds.Complex=LatexCmds.complexes=LatexCmds.Complexes=LatexCmds.complexplane=LatexCmds.Complexplane=LatexCmds.ComplexPlane=bind(VanillaSymbol,"\\mathbb{C}","&#8450;"),LatexCmds.H=LatexCmds.Hamiltonian=LatexCmds.quaternions=LatexCmds.Quaternions=bind(VanillaSymbol,"\\mathbb{H}","&#8461;"),LatexCmds.quad=LatexCmds.emsp=bind(VanillaSymbol,"\\quad ","    "),LatexCmds.qquad=bind(VanillaSymbol,"\\qquad ","        "),LatexCmds.diamond=bind(VanillaSymbol,"\\diamond ","&#9671;"),LatexCmds.bigtriangleup=bind(VanillaSymbol,"\\bigtriangleup ","&#9651;"),LatexCmds.ominus=bind(VanillaSymbol,"\\ominus ","&#8854;"),LatexCmds.uplus=bind(VanillaSymbol,"\\uplus ","&#8846;"),LatexCmds.bigtriangledown=bind(VanillaSymbol,"\\bigtriangledown ","&#9661;"),LatexCmds.sqcap=bind(VanillaSymbol,"\\sqcap ","&#8851;"),LatexCmds.triangleleft=bind(VanillaSymbol,"\\triangleleft ","&#8882;"),LatexCmds.sqcup=bind(VanillaSymbol,"\\sqcup ","&#8852;"),LatexCmds.triangleright=bind(VanillaSymbol,"\\triangleright ","&#8883;"),LatexCmds.odot=LatexCmds.circledot=bind(VanillaSymbol,"\\odot ","&#8857;"),LatexCmds.bigcirc=bind(VanillaSymbol,"\\bigcirc ","&#9711;"),LatexCmds.dagger=bind(VanillaSymbol,"\\dagger ","&#0134;"),LatexCmds.ddagger=bind(VanillaSymbol,"\\ddagger ","&#135;"),LatexCmds.wr=bind(VanillaSymbol,"\\wr ","&#8768;"),LatexCmds.amalg=bind(VanillaSymbol,"\\amalg ","&#8720;"),LatexCmds.models=bind(VanillaSymbol,"\\models ","&#8872;"),LatexCmds.prec=bind(VanillaSymbol,"\\prec ","&#8826;"),LatexCmds.succ=bind(VanillaSymbol,"\\succ ","&#8827;"),LatexCmds.preceq=bind(VanillaSymbol,"\\preceq ","&#8828;"),LatexCmds.succeq=bind(VanillaSymbol,"\\succeq ","&#8829;"),LatexCmds.simeq=bind(VanillaSymbol,"\\simeq ","&#8771;"),LatexCmds.mid=bind(VanillaSymbol,"\\mid ","&#8739;"),LatexCmds.ll=bind(VanillaSymbol,"\\ll ","&#8810;"),LatexCmds.gg=bind(VanillaSymbol,"\\gg ","&#8811;"),LatexCmds.parallel=bind(VanillaSymbol,"\\parallel ","&#8741;"),LatexCmds.nparallel=bind(VanillaSymbol,"\\nparallel ","&#8742;"),LatexCmds.bowtie=bind(VanillaSymbol,"\\bowtie ","&#8904;"),LatexCmds.sqsubset=bind(VanillaSymbol,"\\sqsubset ","&#8847;"),LatexCmds.sqsupset=bind(VanillaSymbol,"\\sqsupset ","&#8848;"),LatexCmds.smile=bind(VanillaSymbol,"\\smile ","&#8995;"),LatexCmds.sqsubseteq=bind(VanillaSymbol,"\\sqsubseteq ","&#8849;"),LatexCmds.sqsupseteq=bind(VanillaSymbol,"\\sqsupseteq ","&#8850;"),LatexCmds.doteq=bind(VanillaSymbol,"\\doteq ","&#8784;"),LatexCmds.frown=bind(VanillaSymbol,"\\frown ","&#8994;"),LatexCmds.vdash=bind(VanillaSymbol,"\\vdash ","&#8870;"),LatexCmds.dashv=bind(VanillaSymbol,"\\dashv ","&#8867;"),LatexCmds.nless=bind(VanillaSymbol,"\\nless ","&#8814;"),LatexCmds.ngtr=bind(VanillaSymbol,"\\ngtr ","&#8815;"),LatexCmds.longleftarrow=bind(VanillaSymbol,"\\longleftarrow ","&#8592;"),LatexCmds.longrightarrow=bind(VanillaSymbol,"\\longrightarrow ","&#8594;"),LatexCmds.Longleftarrow=bind(VanillaSymbol,"\\Longleftarrow ","&#8656;"),LatexCmds.Longrightarrow=bind(VanillaSymbol,"\\Longrightarrow ","&#8658;"),LatexCmds.longleftrightarrow=bind(VanillaSymbol,"\\longleftrightarrow ","&#8596;"),LatexCmds.updownarrow=bind(VanillaSymbol,"\\updownarrow ","&#8597;"),LatexCmds.Longleftrightarrow=bind(VanillaSymbol,"\\Longleftrightarrow ","&#8660;"),LatexCmds.Updownarrow=bind(VanillaSymbol,"\\Updownarrow ","&#8661;"),LatexCmds.mapsto=bind(VanillaSymbol,"\\mapsto ","&#8614;"),LatexCmds.nearrow=bind(VanillaSymbol,"\\nearrow ","&#8599;"),LatexCmds.hookleftarrow=bind(VanillaSymbol,"\\hookleftarrow ","&#8617;"),LatexCmds.hookrightarrow=bind(VanillaSymbol,"\\hookrightarrow ","&#8618;"),LatexCmds.searrow=bind(VanillaSymbol,"\\searrow ","&#8600;"),LatexCmds.leftharpoonup=bind(VanillaSymbol,"\\leftharpoonup ","&#8636;"),LatexCmds.rightharpoonup=bind(VanillaSymbol,"\\rightharpoonup ","&#8640;"),LatexCmds.swarrow=bind(VanillaSymbol,"\\swarrow ","&#8601;"),LatexCmds.leftharpoondown=bind(VanillaSymbol,"\\leftharpoondown ","&#8637;"),LatexCmds.rightharpoondown=bind(VanillaSymbol,"\\rightharpoondown ","&#8641;"),LatexCmds.nwarrow=bind(VanillaSymbol,"\\nwarrow ","&#8598;"),LatexCmds.ldots=bind(VanillaSymbol,"\\ldots ","&#8230;"),LatexCmds.cdots=bind(VanillaSymbol,"\\cdots ","&#8943;"),LatexCmds.vdots=bind(VanillaSymbol,"\\vdots ","&#8942;"),LatexCmds.ddots=bind(VanillaSymbol,"\\ddots ","&#8945;"),LatexCmds.surd=bind(VanillaSymbol,"\\surd ","&#8730;"),LatexCmds.triangle=bind(VanillaSymbol,"\\triangle ","&#9651;"),LatexCmds.ell=bind(VanillaSymbol,"\\ell ","&#8467;"),LatexCmds.top=bind(VanillaSymbol,"\\top ","&#8868;"),LatexCmds.flat=bind(VanillaSymbol,"\\flat ","&#9837;"),LatexCmds.natural=bind(VanillaSymbol,"\\natural ","&#9838;"),LatexCmds.sharp=bind(VanillaSymbol,"\\sharp ","&#9839;"),LatexCmds.wp=bind(VanillaSymbol,"\\wp ","&#8472;"),LatexCmds.bot=bind(VanillaSymbol,"\\bot ","&#8869;"),LatexCmds.clubsuit=bind(VanillaSymbol,"\\clubsuit ","&#9827;"),LatexCmds.diamondsuit=bind(VanillaSymbol,"\\diamondsuit ","&#9826;"),LatexCmds.heartsuit=bind(VanillaSymbol,"\\heartsuit ","&#9825;"),LatexCmds.spadesuit=bind(VanillaSymbol,"\\spadesuit ","&#9824;"),LatexCmds.parallelogram=bind(VanillaSymbol,"\\parallelogram ","&#9649;"),LatexCmds.square=bind(VanillaSymbol,"\\square ","&#11036;"),LatexCmds.oint=bind(VanillaSymbol,"\\oint ","&#8750;"),LatexCmds.bigcap=bind(VanillaSymbol,"\\bigcap ","&#8745;"),LatexCmds.bigcup=bind(VanillaSymbol,"\\bigcup ","&#8746;"),LatexCmds.bigsqcup=bind(VanillaSymbol,"\\bigsqcup ","&#8852;"),LatexCmds.bigvee=bind(VanillaSymbol,"\\bigvee ","&#8744;"),LatexCmds.bigwedge=bind(VanillaSymbol,"\\bigwedge ","&#8743;"),LatexCmds.bigodot=bind(VanillaSymbol,"\\bigodot ","&#8857;"),LatexCmds.bigotimes=bind(VanillaSymbol,"\\bigotimes ","&#8855;"),LatexCmds.bigoplus=bind(VanillaSymbol,"\\bigoplus ","&#8853;"),LatexCmds.biguplus=bind(VanillaSymbol,"\\biguplus ","&#8846;"),LatexCmds.lfloor=bind(VanillaSymbol,"\\lfloor ","&#8970;"),LatexCmds.rfloor=bind(VanillaSymbol,"\\rfloor ","&#8971;"),LatexCmds.lceil=bind(VanillaSymbol,"\\lceil ","&#8968;"),LatexCmds.rceil=bind(VanillaSymbol,"\\rceil ","&#8969;"),LatexCmds.opencurlybrace=LatexCmds.lbrace=bind(VanillaSymbol,"\\lbrace ","{"),LatexCmds.closecurlybrace=LatexCmds.rbrace=bind(VanillaSymbol,"\\rbrace ","}"),LatexCmds.lbrack=bind(VanillaSymbol,"["),LatexCmds.rbrack=bind(VanillaSymbol,"]"),LatexCmds.slash=bind(VanillaSymbol,"/"),LatexCmds.vert=bind(VanillaSymbol,"|"),LatexCmds.perp=LatexCmds.perpendicular=bind(VanillaSymbol,"\\perp ","&perp;"),LatexCmds.nabla=LatexCmds.del=bind(VanillaSymbol,"\\nabla ","&nabla;"),LatexCmds.hbar=bind(VanillaSymbol,"\\hbar ","&#8463;"),LatexCmds.AA=LatexCmds.Angstrom=LatexCmds.angstrom=bind(VanillaSymbol,"\\text\\AA ","&#8491;"),LatexCmds.ring=LatexCmds.circ=LatexCmds.circle=bind(VanillaSymbol,"\\circ ","&#8728;"),LatexCmds.bull=LatexCmds.bullet=bind(VanillaSymbol,"\\bullet ","&bull;"),LatexCmds.setminus=LatexCmds.smallsetminus=bind(VanillaSymbol,"\\setminus ","&#8726;"),LatexCmds.not=LatexCmds["¬"]=LatexCmds.neg=bind(VanillaSymbol,"\\neg ","&not;"),LatexCmds["…"]=LatexCmds.dots=LatexCmds.ellip=LatexCmds.hellip=LatexCmds.ellipsis=LatexCmds.hellipsis=bind(VanillaSymbol,"\\dots ","&hellip;"),LatexCmds.converges=LatexCmds.darr=LatexCmds.dnarr=LatexCmds.dnarrow=LatexCmds.downarrow=bind(VanillaSymbol,"\\downarrow ","&darr;"),LatexCmds.dArr=LatexCmds.dnArr=LatexCmds.dnArrow=LatexCmds.Downarrow=bind(VanillaSymbol,"\\Downarrow ","&dArr;"),LatexCmds.diverges=LatexCmds.uarr=LatexCmds.uparrow=bind(VanillaSymbol,"\\uparrow ","&uarr;"),LatexCmds.uArr=LatexCmds.Uparrow=bind(VanillaSymbol,"\\Uparrow ","&uArr;"),LatexCmds.to=bind(BinaryOperator,"\\to ","&rarr;"),LatexCmds.rarr=LatexCmds.rightarrow=bind(VanillaSymbol,"\\rightarrow ","&rarr;"),LatexCmds.implies=bind(BinaryOperator,"\\Rightarrow ","&rArr;"),LatexCmds.rArr=LatexCmds.Rightarrow=bind(VanillaSymbol,"\\Rightarrow ","&rArr;"),LatexCmds.gets=bind(BinaryOperator,"\\gets ","&larr;"),LatexCmds.larr=LatexCmds.leftarrow=bind(VanillaSymbol,"\\leftarrow ","&larr;"),LatexCmds.impliedby=bind(BinaryOperator,"\\Leftarrow ","&lArr;"),LatexCmds.lArr=LatexCmds.Leftarrow=bind(VanillaSymbol,"\\Leftarrow ","&lArr;"),LatexCmds.harr=LatexCmds.lrarr=LatexCmds.leftrightarrow=bind(VanillaSymbol,"\\leftrightarrow ","&harr;"),LatexCmds.iff=bind(BinaryOperator,"\\Leftrightarrow ","&hArr;"),LatexCmds.hArr=LatexCmds.lrArr=LatexCmds.Leftrightarrow=bind(VanillaSymbol,"\\Leftrightarrow ","&hArr;"),LatexCmds.Re=LatexCmds.Real=LatexCmds.real=bind(VanillaSymbol,"\\Re ","&real;"),LatexCmds.Im=LatexCmds.imag=LatexCmds.image=LatexCmds.imagin=LatexCmds.imaginary=LatexCmds.Imaginary=bind(VanillaSymbol,"\\Im ","&image;"),LatexCmds.part=LatexCmds.partial=bind(VanillaSymbol,"\\partial ","&part;"),LatexCmds.infty=LatexCmds.infin=LatexCmds.infinity=bind(VanillaSymbol,"\\infty ","&infin;");LatexCmds.pounds=bind(VanillaSymbol,"\\pounds ","&pound;"),LatexCmds.alef=LatexCmds.alefsym=LatexCmds.aleph=LatexCmds.alephsym=bind(VanillaSymbol,"\\aleph ","&alefsym;"),LatexCmds.xist=LatexCmds.xists=LatexCmds.exist=LatexCmds.exists=bind(VanillaSymbol,"\\exists ","&exist;"),LatexCmds.nexists=LatexCmds.nexist=bind(VanillaSymbol,"\\nexists ","&#8708;"),LatexCmds.and=LatexCmds.land=LatexCmds.wedge=bind(BinaryOperator,"\\wedge ","&and;"),LatexCmds.or=LatexCmds.lor=LatexCmds.vee=bind(BinaryOperator,"\\vee ","&or;"),LatexCmds.o=LatexCmds.O=LatexCmds.empty=LatexCmds.emptyset=LatexCmds.oslash=LatexCmds.Oslash=LatexCmds.nothing=LatexCmds.varnothing=bind(BinaryOperator,"\\varnothing ","&empty;"),LatexCmds.cup=LatexCmds.union=bind(BinaryOperator,"\\cup ","&cup;"),LatexCmds.cap=LatexCmds.intersect=LatexCmds.intersection=bind(BinaryOperator,"\\cap ","&cap;"),LatexCmds.deg=LatexCmds.degree=bind(VanillaSymbol,"\\degree ","&deg;"),LatexCmds.ang=LatexCmds.angle=bind(VanillaSymbol,"\\angle ","&ang;"),LatexCmds.measuredangle=bind(VanillaSymbol,"\\measuredangle ","&#8737;"),Digit=P(VanillaSymbol,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[L]instanceof Variable&&!1!==t[L].isItalic||t[L]instanceof SupSub&&t[L][L]instanceof Variable&&!1!==t[L][L].isItalic)?(LatexCmds._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}}),Variable=P(Symbol,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return this.isPartOfOperator?"\\"==t[0]?t=t.slice(1,t.length):" "==t[t.length-1]&&(t=t.slice(0,-1)):(!this[L]||this[L]instanceof Variable||this[L]instanceof BinaryOperator||"\\ "===this[L].ctrlSeq||(t="*"+t),!this[R]||this[R]instanceof BinaryOperator||this[R]instanceof SupSub||(t+="*")),t}}),Options.p.autoCommands={_maxLength:0},optionProcessors.autoCommands=function(t){var e,n,i,s,a;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(a=e[s],a.length<2)throw'autocommand "'+a+'" not minimum length of 2';if(LatexCmds[a]===OperatorName)throw'"'+a+'" is a built-in operator name';n[a]=1,i=max(i,a.length)}return n._maxLength=i,n},Letter=P(Variable,function(t,e){function n(t){return!t||t instanceof BinaryOperator||t instanceof SummationNotation}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){var n,i,s,a,r;if(e.createLeftOf.apply(this,arguments),n=t.options.autoCommands,i=n._maxLength,i>0){for(s="",a=this,r=0;a instanceof Letter&&a.ctrlSeq===a.letter&&r<i;)s=a.letter+s,a=a[L],r+=1;for(;s.length;){if(n.hasOwnProperty(s)){for(r=1,a=this;r<s.length;r+=1,a=a[L]);return Fragment(a,this).remove(),t[L]=a[L],LatexCmds[s](s).createLeftOf(t)}s=s.slice(1)}}},t.italicize=function(t){return this.isItalic=t,this.isPartOfOperator=!t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==L&&this[R]instanceof Letter||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e,i,s,a,r,o,l,d,c,u,m,h,p=t.autoOperatorNames;if(0!==p._maxLength){for(e=this.letter,i=this[L];i instanceof Letter;i=i[L])e=i.letter+e;for(s=this[R];s instanceof Letter;s=s[R])e+=s.letter;Fragment(i[R]||this.parent.ends[L],s[L]||this.parent.ends[R]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter});t:for(a=0,r=i[R]||this.parent.ends[L];a<e.length;a+=1,r=r[R])for(o=min(p._maxLength,e.length-a);o>0;o-=1)if(l=e.slice(a,a+o),p.hasOwnProperty(l)){for(d=0,c=r;d<o;d+=1,c=c[R])c.italicize(!1),u=c;m=BuiltInOpNames.hasOwnProperty(l),r.ctrlSeq=(m?"\\":"\\operatorname{")+r.ctrlSeq,u.ctrlSeq+=m?" ":"}",TwoWordOpNames.hasOwnProperty(l)&&u[L][L][L].jQ.addClass("mq-last"),n(r[L])||r.jQ.addClass("mq-first"),n(u[R])||(u[R]instanceof SupSub?(h=u[R],(h.siblingCreated=h.siblingDeleted=function(){h.jQ.toggleClass("mq-after-operator-name",!(h[R]instanceof Bracket))})()):u.jQ.toggleClass("mq-last",!(u[R]instanceof Bracket))),a+=o-1,r=u;continue t}}}}),BuiltInOpNames={},AutoOpNames=Options.p.autoOperatorNames={_maxLength:9},TwoWordOpNames={limsup:1,liminf:1,projlim:1,injlim:1},function(){var t,e,n,i,s="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(t=0;t<s.length;t+=1)BuiltInOpNames[s[t]]=AutoOpNames[s[t]]=1;for(e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),t=0;t<e.length;t+=1)BuiltInOpNames[e[t]]=1;for(n="sin cos tan sec cosec csc cotan cot ctg".split(" "),t=0;t<n.length;t+=1)AutoOpNames[n[t]]=AutoOpNames["arc"+n[t]]=AutoOpNames[n[t]+"h"]=AutoOpNames["ar"+n[t]+"h"]=AutoOpNames["arc"+n[t]+"h"]=1;for(i="gcf hcf lcm proj span".split(" "),t=0;t<i.length;t+=1)AutoOpNames[i[t]]=1}(),optionProcessors.autoOperatorNames=function(t){var e,n,i,s,a;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(a=e[s],a.length<2)throw'"'+a+'" not minimum length of 2';n[a]=1,i=max(i,a.length)}return n._maxLength=i,n},OperatorName=P(Symbol,function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){var e,n=this.ctrlSeq;for(e=0;e<n.length;e+=1)Letter(n.charAt(e)).createLeftOf(t)},t.parser=function(){var t,e=this.ctrlSeq,n=MathBlock();for(t=0;t<e.length;t+=1)Letter(e.charAt(t)).adopt(n,n.ends[R],0);return Parser.succeed(n.children())}});for(fn in AutoOpNames)AutoOpNames.hasOwnProperty(fn)&&(LatexCmds[fn]=OperatorName);LatexCmds.operatorname=P(MathCommand,function(t){t.createLeftOf=noop,t.numBlocks=function(){return 1},t.parser=function(){return latexMathParser.block.map(function(t){return t.children()})}}),LatexCmds.f=P(Letter,function(t,e){t.init=function(){Symbol.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),LatexCmds[" "]=LatexCmds.space=bind(VanillaSymbol,"\\ ","&nbsp;"),LatexCmds["'"]=LatexCmds.prime=bind(VanillaSymbol,"'","&prime;"),LatexCmds["″"]=LatexCmds.dprime=bind(VanillaSymbol,"″","&Prime;"),LatexCmds.backslash=bind(VanillaSymbol,"\\backslash ","\\"),CharCmds["\\"]||(CharCmds["\\"]=LatexCmds.backslash),LatexCmds.$=bind(VanillaSymbol,"\\$","$"),NonSymbolaSymbol=P(Symbol,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}}),LatexCmds["@"]=NonSymbolaSymbol,LatexCmds["&"]=bind(NonSymbolaSymbol,"\\&","&amp;"),LatexCmds["%"]=bind(NonSymbolaSymbol,"\\%","%"),LatexCmds.alpha=LatexCmds.beta=LatexCmds.gamma=LatexCmds.delta=LatexCmds.zeta=LatexCmds.eta=LatexCmds.theta=LatexCmds.iota=LatexCmds.kappa=LatexCmds.mu=LatexCmds.nu=LatexCmds.xi=LatexCmds.rho=LatexCmds.sigma=LatexCmds.tau=LatexCmds.chi=LatexCmds.psi=LatexCmds.omega=P(Variable,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),LatexCmds.phi=bind(Variable,"\\phi ","&#981;"),LatexCmds.phiv=LatexCmds.varphi=bind(Variable,"\\varphi ","&phi;"),LatexCmds.epsilon=bind(Variable,"\\epsilon ","&#1013;"),LatexCmds.epsiv=LatexCmds.varepsilon=bind(Variable,"\\varepsilon ","&epsilon;"),LatexCmds.piv=LatexCmds.varpi=bind(Variable,"\\varpi ","&piv;"),LatexCmds.sigmaf=LatexCmds.sigmav=LatexCmds.varsigma=bind(Variable,"\\varsigma ","&sigmaf;"),LatexCmds.thetav=LatexCmds.vartheta=LatexCmds.thetasym=bind(Variable,"\\vartheta ","&thetasym;"),LatexCmds.upsilon=LatexCmds.upsi=bind(Variable,"\\upsilon ","&upsilon;"),LatexCmds.gammad=LatexCmds.Gammad=LatexCmds.digamma=bind(Variable,"\\digamma ","&#989;"),LatexCmds.kappav=LatexCmds.varkappa=bind(Variable,"\\varkappa ","&#1008;"),LatexCmds.rhov=LatexCmds.varrho=bind(Variable,"\\varrho ","&#1009;"),LatexCmds.pi=LatexCmds["π"]=bind(NonSymbolaSymbol,"\\pi ","&pi;"),LatexCmds.lambda=bind(NonSymbolaSymbol,"\\lambda ","&lambda;"),LatexCmds.Upsilon=LatexCmds.Upsi=LatexCmds.upsih=LatexCmds.Upsih=bind(Symbol,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),LatexCmds.Gamma=LatexCmds.Delta=LatexCmds.Theta=LatexCmds.Lambda=LatexCmds.Xi=LatexCmds.Pi=LatexCmds.Sigma=LatexCmds.Phi=LatexCmds.Psi=LatexCmds.Omega=LatexCmds.forall=P(VanillaSymbol,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),LatexFragment=P(MathCommand,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=latexMathParser.parse(this.latex);e.children().adopt(t.parent,t[L],t[R]),t[L]=e.ends[R],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[R][R].siblingCreated&&e.ends[R][R].siblingCreated(t.options,L),e.ends[L][L].siblingCreated&&e.ends[L][L].siblingCreated(t.options,R),t.parent.bubble("reflow")},t.parser=function(){var t=latexMathParser.parse(this.latex).children();return Parser.succeed(t)}}),LatexCmds["¹"]=bind(LatexFragment,"^1"),LatexCmds["²"]=bind(LatexFragment,"^2"),LatexCmds["³"]=bind(LatexFragment,"^3"),LatexCmds["¼"]=bind(LatexFragment,"\\frac14"),LatexCmds["½"]=bind(LatexFragment,"\\frac12"),LatexCmds["¾"]=bind(LatexFragment,"\\frac34"),PlusMinus=P(BinaryOperator,function(t){t.init=VanillaSymbol.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){function n(t){return t[L]?t[L]instanceof BinaryOperator||/^[,;:\(\[]$/.test(t[L].ctrlSeq)?"":"mq-binary-operator":t.parent&&t.parent.parent&&t.parent.parent.isStyleBlock()?n(t.parent.parent):""}if(e!==R)return this.jQ[0].className=n(this),this}}),LatexCmds["+"]=bind(PlusMinus,"+","+"),LatexCmds["–"]=LatexCmds["-"]=bind(PlusMinus,"-","&minus;"),LatexCmds["±"]=LatexCmds.pm=LatexCmds.plusmn=LatexCmds.plusminus=bind(PlusMinus,"\\pm ","&plusmn;"),LatexCmds.mp=LatexCmds.mnplus=LatexCmds.minusplus=bind(PlusMinus,"\\mp ","&#8723;"),CharCmds["*"]=LatexCmds.sdot=LatexCmds.cdot=bind(BinaryOperator,"\\cdot ","&middot;","*"),Inequality=P(BinaryOperator,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":"";e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){if(t===L&&!this.strict)return this.swap(!0),void this.bubble("reflow");e.deleteTowards.apply(this,arguments)}}),less={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},greater={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},LatexCmds["<"]=LatexCmds.lt=bind(Inequality,less,!0),LatexCmds[">"]=LatexCmds.gt=bind(Inequality,greater,!0),LatexCmds["≤"]=LatexCmds.le=LatexCmds.leq=bind(Inequality,less,!1),LatexCmds["≥"]=LatexCmds.ge=LatexCmds.geq=bind(Inequality,greater,!1),Equality=P(BinaryOperator,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){if(t[L]instanceof Inequality&&t[L].strict)return t[L].swap(!1),void t[L].bubble("reflow");e.createLeftOf.apply(this,arguments)}}),LatexCmds["="]=Equality,LatexCmds["×"]=LatexCmds.times=bind(BinaryOperator,"\\times ","&times;","[x]"),LatexCmds["÷"]=LatexCmds.div=LatexCmds.divide=LatexCmds.divides=bind(BinaryOperator,"\\div ","&divide;","[/]"),CharCmds["~"]=LatexCmds.sim=bind(BinaryOperator,"\\sim ","~","~"),MQ1=getInterface(1);for(key in MQ1)!function(t,e){"function"==typeof e?(MathQuill[t]=function(){return insistOnInterVer(),e.apply(this,arguments)},MathQuill[t].prototype=e.prototype):MathQuill[t]=e}(key,MQ1[key]);module.exports=MathQuill;
